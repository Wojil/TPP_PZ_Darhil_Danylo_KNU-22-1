@{
    ViewData["Title"] = "Кошик";
}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $("#updateCartButton").click(function (e) {
            e.preventDefault(); // Предотвращаем отправку формы по умолчанию

            // Получаем все значения input с именем quantities и создаем массив
            var quantities = $("input[name^='quantities']").map(function () {
                return $(this).val();
            }).get();

            // Отправляем массив quantities на сервер
            $.ajax({
                url: "@Url.Action("UpdateCart","Cart")",
                type: "get",
                traditional: true,
                data: { quantities: quantities },
                success: function (response) {
                    // Обработка успешного ответа от сервера
                    // ...
                },
                error: function () {
                    // Обработка ошибки
                    // ...
                }
            });
        });
    });
</script>
<style>
    .tbody {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 60vh;
    }

    .container {
        text-align: center;
    }

    .button-container {
        margin-top: 10px;
    }

    .card-body {
        text-align: left;
    }
    #input-count{
        text-align:center;
    }

</style>

<div class="text-center">
<h1 class="page-title">Кошик</h1>
</div>
<div class="container mb-3">
<div class="container">
    @if (Model == null || Model.Count == 0)
    {
        <div class="tbody">
            <div class="container">
                <b style="font-size: 20px;">Ваш кошик порожній !</b>
            </div>
            </div>
        }
        else if(Model[0].Quantity<0)
        {
            <div class="tbody">
                <div class="container">
                    <b style="font-size: 20px;">Ваше замовлення надійшло в обробку ! Його номер: @Model[0].AutoPart.Id</b>
                </div>
            </div>

        }
        else
    {
        @for (int i = 0; i < Model.Count; i++)
        {
            var cartPart = Model[@i];
            <div class="card mb-3">
                <div class="card-header"><h2 class="card-title">@cartPart.AutoPart.Name</h2></div>
                <div class="card-body"><p>Код:@cartPart.AutoPart.Code</p>
                    <p class ="card-text">Модель авто: @cartPart.AutoPart.AutoModel.AutoModelName</p>
                    <p class ="card-text">Тип деталі: @cartPart.AutoPart.PartType.TypeName</p>
                    <p class ="card-text">Категорія деталі: @cartPart.AutoPart.PartCategory.CategoryName</p>
                    <p class ="card-text">Виробник: @cartPart.AutoPart.ManufacturerBrand.BrandName</p>
                    <p class ="card-text">Країна виробник: @cartPart.AutoPart.ManufacturerCountry.CountryName</p>
                    <p class ="card-text">Опис: @cartPart.AutoPart.Description</p>
                    <p class="card-text">Ціна: @cartPart.AutoPart.Price</p>
                    <p class="card-text">Кількість:
                        <input type="number" name="quantities[@i]"  value="@cartPart.Quantity" min="1" max="@cartPart.AutoPart.Quantity" />
                    </p>
                </div>
            <form method="post" asp-controller="Cart" asp-action="Delete">
                        <input type="hidden" name="id" value="@cartPart.AutoPart.Id" />
                        <button type="submit" class="btn btn-danger с mb-3" style="font-size: 16px">Видалити з кошика</button>
                </form>
            </div>
        }
            <form method="get" asp-controller="Cart" asp-action="UpdateCart">
                <button type="submit" id="updateCartButton" class="btn btn-secondary mb-5" style="width: 300px; font-size: 16px;">Оновити кількість товарів</button>
            </form>

            <form method="get" action="@Url.Action("SubmitOrder","Cart")">
                <button type="submit" id="submitOrderButton" class="btn btn-primary mb-5" style="width: 300px; font-size: 16px;">Оформити замовлення</button>
        </form>
    }
        <form method="get" action="@Url.Action("BackToCatalog","Cart")">
            <button type="submit" class="btn btn-warning " style="width: 300px; font-size: 16px;">Повернутись до вибору товарів</button>
        </form>

    </div>
</div>